image: python:3.7

lint:
  before_script:
    - pip install flake8
  script:
    - flake8 --config=.flake8

test:
  before_script:
    - apt install wget
    - wget https://geolite.maxmind.com/download/geoip/database/GeoLite2-Country.tar.gz https://geolite.maxmind.com/download/geoip/database/GeoLite2-ASN.tar.gz
    - tar zxf GeoLite2-Country.tar.gz
    - tar zxf GeoLite2-ASN.tar.gz
    - pip install -r requirements.txt
    - mv test/config.yml ./config.yml
    - mv GeoLite2*/*mmdb ./test/
  script: 
    - cd test
    - ls -l
    - export PYTHONPATH="$(pwd)/.."
    - python nic.cz.test.py
    - mv config-nodns.yml ../config.yml
    - python nic.cz.test.py > nic.cz.json
  artifacts:
    paths:
      - nic.cz.json
